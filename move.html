<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
        box-sizing: border-box;
        }
        body {
        margin: 0px;
        padding: 0px;
        }
        .label {
        font-size: 12px;
        color: red;
        cursor: pointer;
        }
        canvas{
        width: 50%;
        height: 50%;
        margin: auto;
        }
        #menuPanel {
        position: absolute;
        background-color: rgba(255, 255, 255, 0.5);
        top: 0px;
        left: 0px;
        width: 100%;
        height: 100%;
        }
        #startButton {
            height: 50px;
            width: 200px;
            margin: -25px -100px;
            position: relative;
            top: 50%;
            left: 50%;
            font-size: 32px;
        }

    </style>
    </head>
    <body>
        <div id="menuPanel">
            <button id="startButton">Click to Start</button>
        </div>
    <script async src="https://unpkg.com/es-module-shims@1.8.0/dist/es-module-shims.js"></script>
    <script type="importmap">
        {
        "imports": {
        "three": "https://unpkg.com/three@latest/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@latest/examples/jsm/"
        }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { DRACOLoader } from 'three/addons/loaders/DRACOLoader.js';
        import { CSS2DRenderer, CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';
        // 主畫面渲染
        const renderer=new THREE.WebGLRenderer({
      antialias: true,    //是否開啟反鋸齒
      precision:" highp", //highp/mediump/lowp 著色的精準度選擇，分別為高/中/低
      alpha: true,        //是否設置背景色透明
      premultipliedAlpha: false,  //是否設置Alpha著色透明度
      stencil: false, //是否開啟繪圖緩衝組成
      preserveDrawingBuffer: true, //是否保存繪圖緩衝
      maxLights:1         //maxLights:最大燈光數
    });
    renderer.setSize( window.innerWidth, window.innerHeight );
    document.body.appendChild( renderer.domElement,);
    // 標籤渲染
    const labelRenderer = new CSS2DRenderer();
    labelRenderer.setSize(window.innerWidth, window.innerHeight);
    labelRenderer.domElement.style.position = "absolute";
    labelRenderer.domElement.style.pointerEvents = "none";
    labelRenderer.domElement.style.top = "0px";
    document.body.appendChild(labelRenderer.domElement);
    // 場景及顏色
    const scene = new THREE.Scene();
    const color = new THREE.Color(0x76c7fb);
    // const color = new THREE.Color('black');
    scene.background = color;   
        // 燈光
    // 半球光
    const hemispherelight = new THREE.HemisphereLight( 0x404040, 0x404040, 5 );
    const hemispherehelper = new THREE.HemisphereLightHelper( hemispherelight, 5 );
    hemispherelight.position.set(0, 30, 0);
    scene.add( hemispherelight );
    scene.add( hemispherehelper );
    // 輔助
    const axesHelper = new THREE.AxesHelper( 50 );
    scene.add( axesHelper );
    const gridHelper = new THREE.GridHelper(20, 100);
    scene.add(gridHelper);
    // 射線
    const raycaster = new THREE.Raycaster();
    const pointer = new THREE.Vector2();
    // 相機
    const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 100000 );
    camera.position.set(1,1.5,1);
    camera.lookAt(new THREE.Vector3(0,1,0));
    // 滑鼠控制器
    const menuPanel = document.getElementById('menuPanel')
    const startButton = document.getElementById('startButton')
    startButton.addEventListener(
        'click',function(){
            controls.lock()
        },false)
    const controls = new PointerLockControls(camera, renderer.domElement)
    controls.addEventListener('change', () => console.log("Controls Change"))
    controls.addEventListener('lock', () => (menuPanel.style.display = 'none'))
    controls.addEventListener('unlock', () => (menuPanel.style.display = 'block'))
    // 移動控制
    const onKeyDown = function (event) {
        console.log('Y旋轉',camera.position.x);
        if(camera.position.x<=11){
            switch (event.code) {
        case 'KeyW':
            controls.moveForward(0.5)
            break
        case 'KeyA':
            controls.moveRight(-0.5)
            break
        case 'KeyS':
            controls.moveForward(-0.5)
            break
        case 'KeyD':
            controls.moveRight(0.5)
            break
        }
        }else{
            switch (event.code){
        case 'KeyW':

            camera.position.x==10;
            controls.moveForward(0.5)
            break
        case 'KeyA':
            controls.moveRight(-0.5)
            break
        case 'KeyS':
            controls.moveForward(-0.5)
            break
        case 'KeyD':
            controls.moveRight(0.5)
            break
        }
    }
    }
    document.addEventListener('keydown', onKeyDown, false)
    // 物件
    // 8F樓板
    const planeLoader = new GLTFLoader();
    const dracoLoader = new DRACOLoader();
    dracoLoader.setDecoderPath( '/examples/jsm/libs/draco/' );
    planeLoader.setDRACOLoader( dracoLoader );
    planeLoader.load(
        './models1023/PlaneAllCube2.glb',
        function ( gltf ) {
            gltf.scene.scale.set(5,5,5);
            scene.add(gltf.scene);
            gltf.animations; // Array<THREE.AnimationClip>
            gltf.scene; // THREE.Group
            gltf.scenes; // Array<THREE.Group>
            gltf.cameras; // Array<THREE.Camera>
            gltf.asset; // Object
        // 舞蹈教室標籤
        const DancingRoomDIV = document.createElement('div');
        DancingRoomDIV.className = 'label';
        DancingRoomDIV.textContent = '815舞蹈教室';
        const DancingRoomLabel = new CSS2DObject(DancingRoomDIV);
        DancingRoomLabel.position.set(0,0.5,0);
        gltf.scene.children[0].add(DancingRoomLabel);
        // 烘焙教室標籤
        const BakingRoomDIV = document.createElement('div');
        BakingRoomDIV.className = 'label';
        BakingRoomDIV.textContent = '813烘焙教室';
        const BakingRoomLabel = new CSS2DObject(BakingRoomDIV);
        BakingRoomLabel.position.set(0,0.5,0);
        gltf.scene.children[1].add(BakingRoomLabel);
        // 大手作教室標籤
        const BigDIYRoomDIV = document.createElement('div');
        BigDIYRoomDIV.className = 'label';
        BigDIYRoomDIV.textContent = '811手作教室';
        const BigDIYRoomLabel = new CSS2DObject(BigDIYRoomDIV);
        BigDIYRoomLabel.position.set(0,0.5,0);
        gltf.scene.children[2].add(BigDIYRoomLabel);
        // 小手作教室標籤
        const SmallDIYRoomDIV = document.createElement('div');
        SmallDIYRoomDIV.className = 'label';
        SmallDIYRoomDIV.textContent = '小手作教室';
        const SmallDIYRoomLabel = new CSS2DObject(SmallDIYRoomDIV);
        SmallDIYRoomLabel.position.set(0,0.5,0);
        gltf.scene.children[3].add(SmallDIYRoomLabel);

        
        // resize用於RWD
        window.addEventListener('resize', resetSetting);
        // resetSetting用於RWD
        function resetSetting() {
            renderer.setSize( window.innerWidth, window.innerHeight );
            OBJrenderer.setSize(window.innerWidth/2 , window.innerHeight/2 );
            labelRenderer.setSize(window.innerWidth, window.innerHeight);
            camera.aspect = window.innerWidth / window.innerHeight
            camera.updateProjectionMatrix()
        }  
        },
        );
        
        function animate() {
            requestAnimationFrame( animate );
            renderer.render( scene, camera );
            labelRenderer.render(scene, camera );
        }
        animate();
</script>


</body>
</html>