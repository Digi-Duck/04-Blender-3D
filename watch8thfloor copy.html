<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link rel="stylesheet" href="./css/watch8thfloor copy.css">
  <title>Overview of the 8th floor</title>
  <style>

  </style>
  <title>Document</title>

</head>

<body>
    <div class="loading">
    <div class="sk-cube-grid">
      <div class="sk-cube sk-cube1"></div>
      <div class="sk-cube sk-cube2"></div>
      <div class="sk-cube sk-cube3"></div>
      <div class="sk-cube sk-cube4"></div>
      <div class="sk-cube sk-cube5"></div>
      <div class="sk-cube sk-cube6"></div>
      <div class="sk-cube sk-cube7"></div>
      <div class="sk-cube sk-cube8"></div>
      <div class="sk-cube sk-cube9"></div>
    </div>
    <div class="loadingNumberName">
      <span>載入進度</span>
      <div class="loadingNumber">0</div></div>

  </div>
  <div>
    <h1 class="logo"> <img src="./img/LOGO(橫白透).png" alt=""></h1>
  </div>
  <div class="objView">
    <div class="objCanvas"></div>
    <div class="closeBtnObjView"></div>
    <div id="objInfo-BIG">
      <div class="objInfoPhone" hidden>課表</div>
      <div class="objInfo">
        <div class="Classroom-name">
          815<br>烘焙教室
        </div>

        <div class="Classroom-introduce">
          <div class="col-3">教室資訊</div>
          <div class="col-4">
            <span>該教室與推廣教育組配合，給予校外人士學習之機會，提供相關課程使用：如瑜珈、有氧、拳擊等課程。開課中：瑜珈提斯、空中瑜伽、綜合核心肌力有氧、伸展核心瑜伽、曲線雕塑瑜伽、ZUMBA、拉丁有氧、壺鈴肌力。報名中：TRX懸吊訓練、拳擊有氧、有氧鬆筋雕塑、拉丁雕塑瑜伽、全方位肌力、飆汗燃脂拳擊</span>
          </div>
        </div>
        <div class="curriculum"> <button class="curriculumBtn">課表</button></div>
      </div>
    </div>
  </div>
  <div class="objcurriculum">
    <div class="closeBtnCurriculumInformation"></div>
    <div class="curriculumInformation"><img src="./img/classroom/舞蹈教室課表.png" style="margin:auto"></div>
  </div>
  <div class="nav">
    <ul class="btn-group">
      <a href="index.html">
        <li class="btn">
          <i class="fa-solid fa-arrow-left left"></i>
          回到首頁
        </li>
      </a>
      <a href="move8thfloor.html">
        <li class="btn">
          漫步八樓
          <i class="fa-solid fa-arrow-right right"></i>
        </li>
      </a>
    </ul>
  </div>
  <script async src="https://unpkg.com/es-module-shims@1.8.0/dist/es-module-shims.js"></script>
  <script src="./JS/classroom.js"></script>

  <script type="importmap">
    {
    "imports": {
      "three": "https://unpkg.com/three@latest/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@latest/examples/jsm/"
    }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
    import { DRACOLoader } from 'three/addons/loaders/DRACOLoader.js';
    import { FBXLoader } from 'three/addons/loaders/FBXLoader.js';
    import { CSS2DRenderer, CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';
    // 上面DIV CONST
    // 抓取教室資料
    const objInfo = document.querySelector('.objInfo')

    function newobjInfo(i) {

      const item = records[i]

      objInfo.innerHTML = `<div class="Classroom-name">
              ${item.number}<br>${item.name}
        </div>

        <div class="Classroom-introduce">
          <div class="col-3">教室資訊</div>
          <div class="col-4">
            <span>${item.Information}</span>
          </div>
        </div>
        <div class="curriculum"> <button class="curriculumBtn">課表</button></div>
      </div>`


    }

    const objView = document.querySelector('.objView');
    const closeBtnObjView = document.querySelector('.closeBtnObjView');
    const objCanvas = document.querySelector('.objCanvas');
    const objcurriculum = document.querySelector('.objcurriculum');
    const objInfoBIG = document.querySelector('#objInfo-BIG');
    const closeBtnCurriculumInformation = document.querySelector('.closeBtnCurriculumInformation');
    const curriculumBtn = document.querySelector('.curriculumBtn');
    const objInfoPhone = document.querySelector('.objInfoPhone');
    const curriculumInformation = document.querySelector('.curriculumInformation');

    function changecurriculum(i) {

      const item = records[i]
      curriculumInformation.innerHTML =
        `<img src="${item.img}" style="margin:auto">`


    }
    
    // 監聽課表按鈕打開課表DIV
    curriculumBtn.addEventListener('click', function (e) {
      objcurriculum.style.display = 'block';
      closeBtnObjView.style.display = 'none';
      document.getElementById("objInfoBIG").classList.add("hide");

    });
    // 監聽課表按鈕打開課表DIV-手機板
    objInfoPhone.addEventListener('click', function (e) {
      objcurriculum.style ='opacity:1';
      closeBtnObjView.style = 'display:none';
      objInfoBIG.style = 'display:none';
    });
    // // DIV監聽事件 監聽小畫面開關按鈕關閉 環境OBJscene清空
    closeBtnObjView.addEventListener('click', function (e) {
      objView.style = 'display:none';
    });
    // 監聽課表DIV裡關閉按鈕關閉
    closeBtnCurriculumInformation.addEventListener('click', function (e) {
      objcurriculum.style = 'display:none';
      closeBtnObjView.style ='opacity:1';
      objInfoBIG.style ='opacity:1';
    });
    // 第一渲染
    const renderer = new THREE.WebGLRenderer({
      antialias: true,
      precision: " highp",
      preserveDrawingBuffer: true,
    });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
    // 標籤渲染
    const labelRenderer = new CSS2DRenderer();
    labelRenderer.setSize(window.innerWidth, window.innerHeight);
    labelRenderer.domElement.style.position = "absolute";
    labelRenderer.domElement.style.pointerEvents = "none";
    labelRenderer.domElement.style.top = "0px";
    document.body.appendChild(labelRenderer.domElement);
    // 場景
    const scene = new THREE.Scene();
    const color = new THREE.Color("rgb(173,216,230)");
    scene.background = color;
    // 半球光
    const hemispherelight = new THREE.HemisphereLight(0x404040, 0x404040, 5);
    const hemispherehelper = new THREE.HemisphereLightHelper(hemispherelight, 5);
    hemispherelight.position.set(0, 30, 0);
    scene.add(hemispherelight);
    scene.add(hemispherehelper);
    // 射線
    const raycaster = new THREE.Raycaster();
    const pointer = new THREE.Vector2();
    // 相機
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100000);
    camera.position.set(0, 6, 4);

    // 控制
    const controls = new OrbitControls(camera, renderer.domElement);
    // 第一場景Loader
    const planeLoader = new GLTFLoader();
    const dracoLoader = new DRACOLoader();
    dracoLoader.setDecoderPath('/examples/jsm/libs/draco/');
    planeLoader.setDRACOLoader(dracoLoader);
    planeLoader.load(
      './models/1031PlaneCubehover.glb',
      function (gltf) {
        scene.add(gltf.scene);

        // 第二渲染
        const OBJrenderer = new THREE.WebGLRenderer({
          antialias: true,
          precision: " highp",
          preserveDrawingBuffer: true,
        });
        var w = objCanvas.clientWidth;
        var h = objCanvas.clientHeight;
        OBJrenderer.setSize(w, h);
        objCanvas.appendChild(OBJrenderer.domElement);
        // 第二場景
        const OBJscene = new THREE.Scene();
        OBJscene.background = color;
        // 第二半球光
        const hemispherelight2 = new THREE.HemisphereLight(0x404040, 0x404040, 5);
        hemispherelight.position.set(0, 30, 0);
        // 第二相機
        const OBJcamera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 10000);
        OBJcamera.position.set(1, 0.5, -6);
        // 第二控制
        const OBJcontrols = new OrbitControls(OBJcamera, OBJrenderer.domElement);
        objView.style = 'display:none';
        objcurriculum.style = 'display:none';

        // 第二場景Loader
        function InfoView(InfoViewValue) {
          OBJscene.add(hemispherelight2);
          const OBJLoader = new GLTFLoader();
          const OBJDracoLoader = new DRACOLoader();
          OBJDracoLoader.setDecoderPath('/examples/jsm/libs/draco/');
          OBJLoader.setDRACOLoader(OBJDracoLoader);
          OBJLoader.load(
            './models/1031PlaneClassRoom.glb',
            function (gltf) {
              OBJscene.add(gltf.scene.children[InfoViewValue]);
              OBJscene.add(gltf.scene.children[6]);
            }
          );
        }
        function animate2() {
          requestAnimationFrame(animate2);
          OBJscene.rotation.y += 0.002;
          OBJrenderer.render(OBJscene, OBJcamera);
        }
        animate2();
        // 810教室標籤
        const RoomZeroDIV = document.createElement('div');
        RoomZeroDIV.className = 'label';
        RoomZeroDIV.textContent = '810教室';
        const RoomZeroLabel = new CSS2DObject(RoomZeroDIV);
        RoomZeroLabel.position.set(0, 0.5, 0);
        gltf.scene.children[0].add(RoomZeroLabel);
        RoomZeroDIV.style.pointerEvents = 'auto';
        RoomZeroDIV.addEventListener('click', function (e) {
          console.log('RoomZeroDIV 被點擊了');
          OBJscene.clear();
          objView.style ='opacity:1';
          InfoView(3);
          newobjInfo(4);
          document.addEventListener('click', function (e) {
            if (e.target.classList.contains('curriculumBtn')) {
              console.log('curriculumBtn 被點擊了');
              objcurriculum.style ='opacity:1';
              closeBtnObjView.style.display = 'none';
              objInfoBIG.style.display = 'none';
              changecurriculum(4);

            }
          });


        });

        // 815舞蹈教室標籤
        const RoomOneDIV = document.createElement('div');
        RoomOneDIV.className = 'label';
        RoomOneDIV.textContent = '815舞蹈教室';
        const RoomOneLabel = new CSS2DObject(RoomOneDIV);
        RoomOneLabel.position.set(0, 0.5, 0);
        gltf.scene.children[1].add(RoomOneLabel);
        RoomOneDIV.style.pointerEvents = 'auto';
        RoomOneDIV.addEventListener('click', function (e) {
          OBJscene.clear();
          objView.style ='opacity:1';
          InfoView(4);
          newobjInfo(0);

          document.addEventListener('click', function (e) {
            if (e.target.classList.contains('curriculumBtn')) {
              console.log('curriculumBtn 被點擊了');
              objcurriculum.style ='opacity:1';
              closeBtnObjView.style.display = 'none';
              objInfoBIG.style.display = 'none';
              changecurriculum(0);
            }
          });
        });
        // 813烘焙教室標籤
        const RoomTwoDIV = document.createElement('div');
        RoomTwoDIV.className = 'label';
        RoomTwoDIV.textContent = '813烘焙教室';
        const RoomTwoLabel = new CSS2DObject(RoomTwoDIV);
        RoomTwoLabel.position.set(0, 0.5, 0);
        gltf.scene.children[2].add(RoomTwoLabel);
        RoomTwoDIV.style.pointerEvents = 'auto';
        RoomTwoDIV.addEventListener('click', function (e) {
          OBJscene.clear();
          objView.style ='opacity:1';
          InfoView(0);
          newobjInfo(3);
          document.addEventListener('click', function (e) {
            if (e.target.classList.contains('curriculumBtn')) {
              console.log('curriculumBtn 被點擊了');
              objcurriculum.style ='opacity:1';
              closeBtnObjView.style.display = 'none';
              objInfoBIG.style.display = 'none';
              changecurriculum(3);
            }
          });
        });
        // 814飛輪教室標籤
        const RoomThreeDIV = document.createElement('div');
        RoomThreeDIV.className = 'label';
        RoomThreeDIV.textContent = '814飛輪教室';
        const RoomThreeLabel = new CSS2DObject(RoomThreeDIV);
        RoomThreeLabel.position.set(0, 0.5, 0);
        gltf.scene.children[3].add(RoomThreeLabel);
        RoomThreeDIV.style.pointerEvents = 'auto';
        RoomThreeDIV.addEventListener('click', function (e) {
          OBJscene.clear();
          objView.style ='opacity:1';
          InfoView(2);
          newobjInfo(5);
          document.addEventListener('click', function (e) {
            if (e.target.classList.contains('curriculumBtn')) {
              console.log('curriculumBtn 被點擊了');
              objcurriculum.style ='opacity:1';
              closeBtnObjView.style.display = 'none';
              objInfoBIG.style.display = 'none';
              changecurriculum(5);
            }
          });
        });
        // 811手作教室
        const RoomFourDIV = document.createElement('div');
        RoomFourDIV.className = 'label';
        RoomFourDIV.textContent = '811手作教室';
        const RoomFourLabel = new CSS2DObject(RoomFourDIV);
        RoomFourLabel.position.set(0, 0.5, 0);
        gltf.scene.children[4].add(RoomFourLabel);
        RoomFourDIV.style.pointerEvents = 'auto';
        RoomFourDIV.addEventListener('click', function (e) {
          OBJscene.clear();
          objView.style ='opacity:1';
          InfoView(1);
          newobjInfo(1);
          document.addEventListener('click', function (e) {
            if (e.target.classList.contains('curriculumBtn')) {
              console.log('curriculumBtn 被點擊了');
              objcurriculum.style ='opacity:1';
              closeBtnObjView.style.display = 'none';
              objInfoBIG.style.display = 'none';
              changecurriculum(1);
            }
          });
        });
        // 812手作教室標籤
        const RoomFiveDIV = document.createElement('div');
        RoomFiveDIV.className = 'label';
        RoomFiveDIV.textContent = '812手作教室';
        const RoomFiveLabel = new CSS2DObject(RoomFiveDIV);
        RoomFiveLabel.position.set(0, 0.5, 0);
        gltf.scene.children[5].add(RoomFiveLabel);
        RoomFiveDIV.style.pointerEvents = 'auto';
        RoomFiveDIV.addEventListener('click', function (e) {
          OBJscene.clear();
          objView.style ='opacity:1';
          InfoView(5);
          newobjInfo(2);
          document.addEventListener('click', function (e) {
            if (e.target.classList.contains('curriculumBtn')) {
              console.log('curriculumBtn 被點擊了');
              objcurriculum.style ='opacity:1';
              closeBtnObjView.style.display = 'none';
              objInfoBIG.style.display = 'none';
              changecurriculum(2);
            }
          });

        });

        // 818物聯網教室
        const RoomSixDIV = document.createElement('div');
        RoomSixDIV.className = 'label';
        RoomSixDIV.textContent = '818物聯網教室';
        const RoomSixLabel = new CSS2DObject(RoomSixDIV);
        RoomSixLabel.position.set(0, 0.5, 0);
        gltf.scene.children[37].add(RoomSixLabel);
        RoomSixDIV.style.pointerEvents = 'auto';
        RoomSixDIV.addEventListener('click', function (e) {
          OBJscene.clear();
          objView.style ='opacity:1';
          InfoView(6);
          document.addEventListener('click', function (e) {
            if (e.target.classList.contains('curriculumBtn')) {
              console.log('curriculumBtn 被點擊了');
              objcurriculum.style ='opacity:1';
              closeBtnObjView.style.display = 'none';
              objInfoBIG.style.display = 'none';
              changecurriculum(6);
            }
          });
        });
        // 滑鼠監聽
        window.addEventListener('mousemove', mouseMove);
        window.addEventListener('resize', resetSetting);
        function pointerSetting(event) {
          pointer.x = (event.clientX / window.innerWidth) * 2 - 1;
          pointer.y = - (event.clientY / window.innerHeight) * 2 + 1;
        }
        function mouseMove(event) {
          pointerSetting(event);
          raycaster.setFromCamera(pointer, camera);
          function cubeHover(objValve, cubeValve) {
            gltf.scene.children[objValve].visible = false
            const intersects = raycaster.intersectObject(gltf.scene.children[objValve], true);
            if (intersects.length > 0) {
              gltf.scene.children[objValve].visible = true
              gltf.scene.children[cubeValve].visible = false
            } else {
              gltf.scene.children[objValve].visible = false
              gltf.scene.children[cubeValve].visible = true
            }
          }
          cubeHover(0, 34);
          cubeHover(1, 18);
          cubeHover(2, 17);
          cubeHover(3, 33);
          cubeHover(4, 32);
          cubeHover(5, 16);
          cubeHover(37, 19);
        }
        // resetSetting用於RWD
        function resetSetting() {
          renderer.setSize(window.innerWidth, window.innerHeight);
          labelRenderer.setSize(window.innerWidth, window.innerHeight);
          camera.aspect = window.innerWidth / window.innerHeight;
          camera.updateProjectionMatrix();
        }
      },
      function ( xhr ) {
      const loadingNumber = document.querySelector('.loadingNumber');
      const loading = document.querySelector('.loading');
      var number= ( xhr.loaded / xhr.total * 100 ).toFixed(1);
      loadingNumber.textContent = number;
      console.dir(number);
      if(number == 100.0){
        let timeRun = 1;
        let timerA = setInterval(function () {
                timeRun-- ;
                if (timeRun <= 0) {
                clearTimeout(timerA);
                loading.style.display = 'none';
                }
            }, 1000);
      }
      },
    );
    function animate() {
      requestAnimationFrame(animate);
      scene.rotation.y += 0.002;
      renderer.render(scene, camera);
      labelRenderer.render(scene, camera);
    }

    animate();

  </script>


</body>

</html>