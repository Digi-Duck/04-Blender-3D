<!DOCTYPE html>
<html lang="en">
<head>
  <!--參考 https://sbcode.net/threejs/pointerlock-controls/ -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
    * {
        box-sizing: border-box;
    }   
    body {
        overflow: hidden;
        margin: 0px;
    }

    #menuPanel {
        position: absolute;
        background-color: rgba(255, 255, 255, 0.5);
        top: 0px;
        left: 0px;
        width: 100%;
        height: 100%;
    }

    #startButton {
        height: 50px;
        width: 200px;
        margin: -25px -100px;
        position: relative;
        top: 50%;
        left: 50%;
        font-size: 32px;
    }
    </style>
</head>
<body>

    <div id="menuPanel">
        <button id="startButton">Click to Start</button>
    </div>
    <script type="module" src="bundle.js"></script>

    <script async src="https://unpkg.com/es-module-shims@1.8.0/dist/es-module-shims.js"></script>

    <script type="importmap">
        {
        "imports": {
        "three": "https://unpkg.com/three@latest/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@latest/examples/jsm/"
        }
        }
    </script>

    <script script type="module">

    import * as THREE from 'three';
    import { FBXLoader } from 'three/addons/loaders/FBXLoader.js';
    import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';
    import { MTLLoader } from 'three/addons/loaders/MTLLoader.js';
    import { GUI } from 'three/addons/libs/lil-gui.module.min.js';
    import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';
    import { CSS2DRenderer, CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';

    // 生成一個場景
    const scene = new THREE.Scene();
    const color = new THREE.Color(0x76c7fb);
    scene.background = color;    

    const camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 0.1, 10000 );
    // Camera:Setup
    camera.position.set(0,10,0);
    camera.lookAt(new THREE.Vector3(0,10,0));

    // const light = new THREE.AmbientLight( 0x404040,10 ); // soft white light
    // scene.add( light );

    const renderer = new THREE.WebGLRenderer()
    renderer.setSize(window.innerWidth, window.innerHeight)
    document.body.appendChild(renderer.domElement)

    const menuPanel = document.getElementById('menuPanel')
    const startButton = document.getElementById('startButton')
    startButton.addEventListener(
        'click',
        function () {
            controls.lock()
        },
        false
    )

    const controls = new PointerLockControls(camera, renderer.domElement)
    controls.addEventListener('change', () => console.log("Controls Change"))
    controls.addEventListener('lock', () => (menuPanel.style.display = 'none'))
    controls.addEventListener('unlock', () => (menuPanel.style.display = 'block'))



    // Object:Plane
    let PlaneGeometry1 = new THREE.PlaneGeometry(10, 10);
    let PlaneMaterial1 = new THREE.MeshPhongMaterial({ color: "white", wireframe: false });
    let Plane1 = new THREE.Mesh(PlaneGeometry1, PlaneMaterial1);
    Plane1.rotation.x -= Math.PI / 2;
    Plane1.scale.x = 0;
    Plane1.scale.y = 0;
    Plane1.receiveShadow = true;
    scene.add(Plane1);

   //物物物物物物物物物物物物物物物物物物物物物物物物件件件件件件件件件件件件件件件
   // 地板~~~~~~~~~~
   const planeOBJloader = new OBJLoader();
    const planeMTLloader = new MTLLoader();
    planeMTLloader.load(
        './models1023/8FPlane.mtl',
        (materials)=>{
            materials.side = THREE.DoubleSide;
            planeOBJloader.setMaterials(materials);
        },
    );
    planeOBJloader.load(
        './models1023/8FPlane.obj',
        function ( object ) {
          object.scale.set(0.1,0.1,0.1);
          scene.add( object );
        },
    );




    // Object:Light:1
    let light1 = new THREE.PointLight("white", 396.8);
    light1.position.set(0, 3, 0);
    light1.castShadow = true;
    light1.shadow.camera.near = 2.5;
    scene.add(light1);
    // Object:Light:2
    let light2 = new THREE.AmbientLight("white", 1 );
    light2.position.set(10, 5, 0);
    scene.add(light2);


    const onKeyDown = function (event) {
    switch (event.code) {
        case 'KeyW':
            controls.moveForward(0.25)
            break
        case 'KeyA':
            controls.moveRight(-0.25)
            break
        case 'KeyS':
            controls.moveForward(-0.25)
            break
        case 'KeyD':
            controls.moveRight(0.25)
            break
    }
}
document.addEventListener('keydown', onKeyDown, false)

window.addEventListener('resize', onWindowResize, false)
function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight
    camera.updateProjectionMatrix()
    renderer.setSize(window.innerWidth, window.innerHeight)
    render()
}

function animate() {
    requestAnimationFrame(animate)
    //controls.update()
    renderer.render(scene, camera)
}

animate()




    </script>
</body>
</html>